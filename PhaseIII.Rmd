---
title: "PhaseIII"
author: "Jiayi Gao"
date: "2019/12/19"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=F, comment=NA, tidy=TRUE, tidy.opts=list(width.cutoff=45), warning=FALSE, message=FALSE, fig.width=6, fig.height=4.5, fig.align='center')
library(ggplot2)
library(dplyr)
library(knitr)
library(ggfortify)
library(tidyverse)
library(xtable)
library(reshape2)
library(grid)
library(gridExtra)
Data <- read.csv(file= "(Revised)LifeExperienceMatters(2).csv", header=TRUE, sep=",")
```

## R Markdown





Thirdly, to test if there exists a significant association between two variables, a chi-square test for association is performed.The null hypothesis for this test is H0: there is not an association between the two categorical variables, and the alternative hypothesis is Ha:there is an association between two categorical variables. Before performing chi-square test, the study has to check if the expected count of each cell is greater than 5. After checking the expected count, the study can put the expected count into a two way table that exactly matches the null hypothesis of no relationship. The remaining task is to calculate the chi-square statistic by using the formula $\begin{aligned} X^2&=\sum\frac{(Observed-Expected)^2}{Expected} \\\end{aligned}$. Before the study can find p-value, the degree of freedom is needed. By using (row-1)*(column-1), the study can find the degree of freedom. The p-value for the test can be found by using the upper tail of a chi-square distribution with the corresponding degrees of freedom. Finally, if the p-value is less than the significance level $\alpha$ (usually 0.05), the study has fairly strong evidence that there is an association between the two variables.





H~0~: School year is associated with Wakeup time \newline
H~A~: School year is not associated with Wakeup time

|  | Freshmen |  Sophomore   |  Junior | Senior | 
|:----|:----:|----:|----:|----:|----:|
| WAKEUP AT NIGHT |  13.03  |  10.51 | 14.29  | 19.76 | 
| NOT WAKEUP AT NIGHT | 17.97 | 14.49 | 19.71 | 27.24 | 


```{r cars}
NewData = Data %>% 
  mutate(Stem=recode(Major,
                     `STEM (Science, Technology, Engineering, Mathematics)`="Yes",
                     .default = "No"),
         AcademicHour = ClassHour + StudyHour, 
         CreditsHorL= recode(Credits, 
                              '1' = "low", '2' = "low", '3' = "low", 
                              '4' = "low", '5' = "low", '6' = "low", 
                              '7' = "low", '8' = "low", '9' = "low", 
                              '10' = "low", '11' = "low", '12' = "low", 
                              '13' = "low", '14' = "low",'15' = "low", .default = "high"),
        WAKEup = recode(WeakupTime, 'Zero' = "NO", .default = "YES")
         
          )


# Freshmen
FreshmenYes <- NewData %>% 
  filter(SchoolYear == "Freshmen") %>% 
  count(WAKEup == 'YES')

FreshmenNo <- NewData %>% 
  filter(SchoolYear == "Freshmen") %>% 
  count(WAKEup == 'NO')

# Sophomore
SophomoreYes <- NewData %>% 
  filter(SchoolYear == "Sophomore") %>% 
  count(WAKEup == 'YES')

SophomoreNo <- NewData %>% 
  filter(SchoolYear == "Sophomore") %>% 
  count(WAKEup == 'NO')
# Junior
JuniorYes <- NewData %>% 
  filter(SchoolYear == "Junior") %>% 
  count(WAKEup == 'YES')

JuniorNo <- NewData %>% 
  filter(SchoolYear == "Junior") %>% 
  count(WAKEup == 'NO')

# Senior
SeniorYes <- NewData %>% 
  filter(SchoolYear == "Senior") %>% 
  count(WAKEup == 'YES')

SeniorNo <- NewData %>% 
  filter(SchoolYear == "Senior") %>% 
  count(WAKEup == 'NO')


year.wake <- as.table(rbind(c(44,20), c(71,37), c(26,15),c(25,15)))
dimnames(year.wake) <- list(Year = c("Freshmen", "Sophomore", "Junior","Senior"),
                    Wake = c("YES","NO"))
df <- year.wake %>% 
  as.data.frame() %>% 
  rename(obs.counts = Freq)

df.row <- df %>% 
  group_by(Year) %>% 
  summarize(row.counts = sum(obs.counts))

df.col <- df %>% 
  group_by(Wake) %>% 
  summarize(col.counts = sum(obs.counts))

df <- df %>% 
  left_join(df.row,by="Year") %>% 
  left_join(df.col,by="Wake")

year.wake %>% 
  as.data.frame() %>% 
  rename(obs.counts = Freq) %>% 
  ggplot(aes(x=Wake,y=obs.counts,fill=Year)) +
  geom_bar(aes(color=Year),position="dodge",stat="identity",alpha = 0.25) + 
  labs(x = "Gender", 
       y = "Count", 
       title = "Wakeup or not",
       fill = "Wakeup or not",
       color = "Wakeup or not") + 
  theme_classic() + 
  theme(plot.title=element_text(size=10),
        axis.title=element_text(size=10),
        legend.title=element_text(size=10))


df <- df %>% 
  mutate(n = sum(obs.counts),
         exp.counts = row.counts*col.counts/n)

df %>% 
  mutate(check = exp.counts >= 5) %>% 
  summarize(check.all = prod(check) == 1)

df <- df %>%
  select(Year, Wake, obs.counts, exp.counts) 

df %>% 
  kable()



df <- df %>% 
  mutate(X.sq = (obs.counts-exp.counts)^2/exp.counts)

df %>% 
  kable()


```


|  | Freshmen |  Sophomore   |  Junior | Senior | TOTAL|
|:----|:----:|----:|----:|----:|----:|
| WAKEUP AT NIGHT |  44  |  71 | 26  | 25 | 166 |
| NOT WAKEUP AT NIGHT | 20 | 37 | 15 | 15 | 87  |
| TOTAL | 64 | 108 | 41 | 40 | 253

```{r pressure, echo=FALSE}

x = matrix(c(44,71,26,25,20,37,15,15),nrow=2,ncol=4)
chisq.test(x)


```


F-statistic is also computed from ANOVA table.$$\begin{aligned} F=\frac{MSModel}{MSE} = \frac{5.3118262}{0.9646079} = 5.50672 \\\end{aligned}$$

```{r}
pf(5.50672, df1 = 1, df2 = 255, lower.tail = FALSE)
```

$$
\begin{aligned}
  F&\sim F_{255} \\
  p-value&=P(|F|\geq |t|) \\
  &=P(|T|\geq 5.50672) \\
  &= 0.01970942\\
\end{aligned}
$$

```{r}

t = -2.35
x <- seq(-5, 5, length=100)
y <- dt(x, 255)
gg1 = ggplot(data.frame(x, y), aes(x = x, y = y)) + geom_line() +
labs(x = "t",
y = "Density",
title = "t-distribution with degree 255") +
theme_classic() +
theme(plot.title=element_text(size=10),
axis.title=element_text(size=10),
legend.title=element_text(size=10))

gg1.data <- ggplot_build(gg1)$data
temp1 <- gg1.data[[1]] %>% filter(x <= t)
temp2 <- gg1.data[[1]] %>% filter(x >= -t)

p1 = gg1 + geom_area(data = temp1, aes(x=x, y=y, color=factor(1), fill=factor(1)), alpha = 0.5) +
geom_area(data = temp2, aes(x=x, y=y, color=factor(1), fill=factor(1)), alpha = 0.5)

f = 5.50672
x <- seq(0, 8, length=100)
y <- df(x, df1 = 1, df2 = 255)
gg2 = ggplot(data.frame(x, y), aes(x = x, y = y)) + geom_line() +
labs(x = "t",
y = "Density",
title = "F-distribution with degree 1 and 255") +
theme_classic() +
theme(plot.title=element_text(size=10),
axis.title=element_text(size=10),
legend.title=element_text(size=10))

gg2.data <- ggplot_build(gg2)$data
temp <- gg2.data[[1]] %>% filter(x >= f)
temp
p2 = gg2 + geom_area(data = temp, aes(x=x, y=y, color=factor(1), fill=factor(1)), alpha = 0.5)

  
grid.arrange(p1, p2, ncol = 2, nrow = 1, top = textGrob("T Distribution and F Distribution"))
```









